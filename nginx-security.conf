# Arquivo de configuração de segurança para nginx
# Para usar, inclua este arquivo na configuração do servidor nginx

# Ocultar versão do nginx
server_tokens off;

# Headers de segurança
add_header X-Frame-Options "DENY" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header X-Content-Type-Options "nosniff" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;
add_header X-Download-Options "noopen" always;
add_header X-Permitted-Cross-Domain-Policies "none" always;

# Content Security Policy
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://www.youtube.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data:; frame-src 'self' https://www.youtube.com; connect-src 'self'" always;

# HSTS (HTTP Strict Transport Security)
add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;

# Permissions Policy
add_header Permissions-Policy "camera=(), microphone=(), geolocation=()" always;

# Prevenir acesso a arquivos sensíveis
location ~ /\.ht {
    deny all;
}

location ~ /\. {
    deny all;
}

location ~* \.(htaccess|htpasswd|ini|log|sh|inc|bak|sql)$ {
    deny all;
}

# Bloquear user agents maliciosos
if ($http_user_agent ~* (HTTrack|libwww-perl|wget|python|nikto|scan|winhttp|clshttp|archiver|loader|email|harvest|extract|grab|miner)) {
    return 403;
}

# Rate limiting
limit_req_zone $binary_remote_addr zone=login:10m rate=5r/m;
limit_req_zone $binary_remote_addr zone=general:10m rate=10r/s;

location / {
    limit_req zone=general burst=20 nodelay;
}

# Gzip compression
gzip on;
gzip_vary on;
gzip_min_length 10240;
gzip_proxied expired no-cache no-store private auth;
gzip_types
    text/plain
    text/css
    text/xml
    text/javascript
    application/x-javascript
    application/javascript
    application/xml+rss
    application/json;

# Cache control
location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}

# Disable directory browsing
autoindex off; 